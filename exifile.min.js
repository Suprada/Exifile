exifile=function(){function e(){m[p].scrollIntoView(),n(m[p]),p++<h-1?setTimeout(e,250):(o(),t())}function t(){nameStub="Scribd.Highlights_"+y.title.split(" ").join("."),jsonFile=JSON.stringify(y),overlay=document.createElement("main"),overlay.setAttribute("class","overlay-results"),l.innerHTML="Done Loading Highlights",document.body.removeChild(l),document.body.appendChild(overlay),overlayHeaderDiv=document.createElement("header"),overlayHeaderDiv.setAttribute("class","header-style"),overlay.appendChild(overlayHeaderDiv),overlayButtons=document.createElement("div"),overlayButtons.setAttribute("class","buttons-header"),overlay.appendChild(overlayButtons),overlayTitle=document.createElement("h2"),overlayTitle.innerHTML=y.title,overlayHeaderDiv.appendChild(overlayTitle),overlayAuthor=document.createElement("h4"),overlayAuthor.innerHTML=y.authors,overlayHeaderDiv.appendChild(overlayAuthor),overlayISBN=document.createElement("h4"),overlayISBN.innerHTML="ISBN: "+y.isbn,overlayHeaderDiv.appendChild(overlayISBN),jsonButton=document.createElement("span"),jsonButton.innerHTML='<button class="button-style" onclick="download((nameStub+\'.json\'),jsonFile)">Download JSON</button>',overlayButtons.appendChild(jsonButton),textFile="",displayText="";for(keys in y)if("object"==typeof y[keys]){displayText+='<ol class="all-quotes">';for(ids in y[keys])textFile+="\n",displayText+='<li class="quote-style">',y[keys][ids].hasOwnProperty("text")&&(displayText+='<span class="text">'+y[keys][ids].text+"</span>",textFile+=y[keys][ids].text+"\n"),y[keys][ids].hasOwnProperty("note")&&(textFile+="NOTE: "+y[keys][ids].note+"\n",displayText+='<br><span class="note">Note: '+y[keys][ids].note+"</span>"),y[keys][ids].hasOwnProperty("location")&&(textFile+="LOCATION: "+y[keys][ids].location+"\n",displayText+='<br><span class="page-number">Page: '+y[keys][ids].location+"</span>"),displayText+="</li>";displayText+="</ol>"}else textFile+=y[keys]+"\n";textButton=document.createElement("span"),textButton.innerHTML='<button style="padding: 10px; margin: 10px;" onclick="download((nameStub+\'.txt\'),textFile)">Download Text</button>',overlayButtons.appendChild(textButton),closeButton=document.createElement("div"),closeButton.setAttribute("class","close-button"),closeButton.innerHTML='<button onclick="closeAll()" style="color: #000;background-color:  #fff;"">X</button>',overlay.appendChild(closeButton),divText=document.createElement("div"),divText.setAttribute("class","highlights-text"),divText.innerHTML=displayText,overlay.appendChild(divText),footer=document.createElement("div"),footer.setAttribute("class","exifile-footer"),footer.innerHTML="<p>Exifile by Suprada | Free your Scribd highlights</p>",overlay.appendChild(footer)}function o(){var e=document.getElementsByClassName("highlight_note");if(e.length>0)for(var t=0;t<e.length;t++){var o=e[t].innerHTML.split("</span>")[1].trim(),n=e[t].parentNode.getAttribute("data-id");y.quotes[n].note=o}}function n(e){for(var t=e.getElementsByClassName("highlight highlight_highlight highlight_highlight"),o=document.getElementsByClassName("pages_info")[1],n=o.innerHTML,l=0;l<t.length;l++){var i=t[l].getAttribute("class"),a=i.split(":")[1],s=t[l].innerHTML;void 0===y.quotes[a]?y.quotes[a]={id:a,text:s,location:n.split(" ")[1]}:y.quotes[a].text+=s}}var l=document.createElement("div");l.setAttribute("class","overlay-info"),document.body.appendChild(l);var i=location.hostname,a=location.pathname.split("/")[1];if(closeAll=function(e){document.body.removeChild(e)},"www.scribd.com"!==i)l.innerHTML="<h1>Login to your book at www.scribd.com to start.</h1>",closeButton=document.createElement("div"),closeButton.setAttribute("class","close-button-e"),closeButton.innerHTML='<button onclick="document.body.removeChild(document.getElementsByClassName(\'overlay-info\')[0])" style="color: #000;background-color:  #fff;"">X</button>',l.appendChild(closeButton);else if("www.scribd.com"===i&&"read"!==a)l.innerHTML="<h1>Please start reading book</h1>",closeButton=document.createElement("div"),closeButton.setAttribute("class","close-button-e"),closeButton.innerHTML='<button onclick="document.body.removeChild(document.getElementsByClassName(\'overlay-info\')[0])" style="color: #000;background-color:  #fff;"">X</button>',l.appendChild(closeButton);else if("www.scribd.com"===i&&"read"===a){l.innerHTML="<h1>Downloading</h1>";for(var s=document.querySelectorAll('[data-action="change_reading_mode"]'),r=0;r<s.length;r++){var d=s[r],c=d.getAttribute("class"),u=d.getAttribute("data-track");"vertical"===u&&-1===c.indexOf("selected")&&(d.click(),document.getElementsByClassName("flat_btn outline_btn apply_changes")[0].click())}var y={};y.title=document.title,y.authors=document.getElementsByClassName("share_pinterest_btn")[0].getAttribute("data-authors"),y.isbn=document.querySelector('meta[property="books:isbn"]').getAttribute("content"),y.highlights=[],y.quotes={};var m=document.getElementsByClassName("reader_columns")[1].children,h=m.length;if(h){var p=0;e()}closeAll=function(){document.body.removeChild(overlay)},download=function(e,t){var o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}}();